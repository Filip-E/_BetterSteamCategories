<html>
<head>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <title>Game DB</title>
</head>
<body>
  <nav class="navbar navbar-default">
    <div class="container-fluid">
      <!-- Collect the nav links, forms, and other content for toggling -->
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
        <ul class="nav navbar-nav">
          <li class="active"><a href="home.html">Home<span class="sr-only">(current)</span></a></li>
        </ul>
      </div><!-- /.navbar-collapse -->
    </div><!-- /.container-fluid -->
  </nav>
  <div class="panel panel-default">
    <div class="panel-heading">
      <h3 class="panel-title">Create Category</h3>
    </div>
    <div class="panel-body">
      <div class="row" id="Create Category">
        <div class="col-md-4">
          <div class="input-group">
            <input id="txtCategoryName" type="text" class="form-control" placeholder="Category Name">
            <span class="input-group-btn">
              <button id="btnCreateCategory" class="btn btn-default" type="button">Create</button>
            </span>
          </div><!-- /input-group -->
        </div><!-- /.col-lg-6 -->
      </div><!-- row -->
    </div>
  </div>
  <div id="Categories">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">Games List</h3>
      </div>
      <div class="panel-body">
        <div class="row" id="gameList">
          <div class="col-md-4">
            <span class="input-group-addon">

              <!-- a list of games gets generated and put here -->
            </span>
          </div><!-- /.col-lg-6 -->
        </div>
      </div>
    </div>
  </div>
</ul>
<script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.2.0.min.js"></script>

<script>
$(document).ready(function(){
  getGame();
  getCategories();
  // create a new Category
  btnCreateCategoryClickListener();
});

//Game List
function getGame(){
  var sUrl = 'http://localhost:8080/gamesList';
  // data which get send to the server
  var apiKey = '6E8C398707989675705EC519EBB8790D';
  var steamId = '76561198082201725';
  var keys = {
    'apiKey' : apiKey,
    'steamId' : steamId
  };
  $.ajax({
    headers:{
      'Accept':'application/json'
    },
    type: 'POST',
    url: sUrl,
    data: JSON.stringify(keys),
    success: function(res){
      console.log(res);
      var gamesArray = res.response.games;
      $.each(gamesArray,function(index, el) {
        setHtmlGameList(index, el);
      });
    },
    dataType: 'json'
  });
};

function setHtmlGameList(htmlID, game){
  var appid = game.appid;
  var name = game.name;
  var iconHash = game.img_icon_url;
  var iconUrl;
  if (iconHash != '') {
    iconUrl = 'http://media.steampowered.com/steamcommunity/public/images/apps/' +
    appid + '/' + iconHash + '.jpg';
  }else {
    console.log(appid);
  }
  var html = '<img src="' + iconUrl + '" />' + name +
  '<input type="checkbox" class="gameListCheckbox"><br /><br />';

  $('#gameList').find('span').append(html);
}

// Categories
function getCategories(){
  var sUrl = 'http://localhost:8080/categories';
  $.ajax({
    headers:{
      'Accept':'application/json'
    },
    type: 'GET',
    url: sUrl,
    success: function(res){
      console.log(res);
      $.each(res.categories,function(index, el) {
        setHtmlNewCategory(el);
      });
    },
    dataType: 'json'
  });
}
function setHtmlNewCategory(category){
  var name = category.name;
  var html = '<div class="panel panel-default"><div class="panel-heading">' +
  '<h3 class="panel-title">' + name + '</h3>'+
  '<button type="button" class="btn btn-default btn-sm"><span class="glyphicon glyphicon-plus"></span></button>'+
  '</div><div class="panel-body">' +
  '<div class="row" id="' + name + '"></div></div></div>';

  $('#Categories').prepend(html);
}
function btnCreateCategoryClickListener(){
  $('#btnCreateCategory').on('click', function(event) {
    event.preventDefault();
    var category = {'name': $('#txtCategoryName').val()};
    var sUrl = 'http://localhost:8080/categories'
    $.ajax({
      headers:{
        'Accept':'application/json'
      },
      type: 'POST',
      url: sUrl ,
      data: JSON.stringify(category),
      success: function(res){
        console.log(res);
        setHtmlNewCategory(res);
        $('#txtCategoryName').val('');
      },
      dataType: 'json'
    });
  });
}
</script>
</body>
</html>
